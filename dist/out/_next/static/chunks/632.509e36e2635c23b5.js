"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[632],{2632:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var r=a(7876),l=a(4232),n=a(5357);async function i(){let e;if(!(!("indexedDB"in window)||await n.idb.historias.count()>0)){try{let t=await fetch("/historias_estructuradas.json",{cache:"no-store"});e=await t.json()}catch(e){console.warn("[seed-idb] No pude cargar historias_estructuradas.json",e);return}Array.isArray(e)&&(await n.idb.transaction("rw",n.idb.historias,n.idb.frases,n.idb.config,async()=>{for(let m of(await n.idb.historias.clear(),await n.idb.frases.clear(),[...e].sort((e,t)=>Number(e.orden||0)-Number(t.orden||0)))){var t,a,r,l,i,o,s,c,d,u,g;let e=await n.idb.historias.add({orden:Number(m.orden),titulo:null!=(a=null!=(t=m.titulo)?t:m.title)?a:null,descripcion:null!=(l=null!=(r=m.descripcion)?r:m.description)?l:null}),y=Array.isArray(m.frases)?m.frases:[];for(let t=0;t<y.length;t++){let a=y[t];await n.idb.frases.add({historiaId:e,historiaOrden:Number(m.orden),orden:Number(null!=(i=a.orden)?i:t+1),textoIngles:null!=(c=null!=(s=null!=(o=a.textoIngles)?o:a.en)?s:a.english)?c:"",traduccion:null!=(g=null!=(u=null!=(d=a.traduccion)?d:a.es)?u:a.spanish)?g:"",nivelActual:0,ultimaRespuesta:null,fechaUltimoEstudio:null,revisarEnFecha:new Date().toISOString()})}}await n.idb.config.put({id:"appConfig",maxOrden:1,metaDefault:20,lastPracticeDate:null,practicedTodayNew:0,practicedTodayTotal:0})}),console.log("[seed-idb] IndexedDB listo ✅"))}}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"America/Bogota";return new Intl.DateTimeFormat("en-CA",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}function s(e){let t=[...e];for(let e=t.length-1;e>0;e--){let a=Math.random()*(e+1)|0;[t[e],t[a]]=[t[a],t[e]]}return t}async function c(e){var t,a;let{limit:r,maxOrden:l,excludeIds:i=[]}=e,c=o(new Date,"America/Bogota"),d=await n.idb.table("config").get("appConfig")||{id:"appConfig",maxOrden:1,metaDefault:20,lastPracticeDate:null,practicedTodayNew:0,practicedTodayTotal:0};d.lastPracticeDate!==c&&(d.lastPracticeDate=c,d.practicedTodayNew=0,d.practicedTodayTotal=0,await n.idb.table("config").put(d));let u=Math.max(0,Number(null!=(t=null!=r?r:d.metaDefault)?t:20)),g=Math.max(1,Number(null!=(a=null!=l?l:d.maxOrden)?a:7)),m=new Set((i||[]).map(String)),y=await n.idb.table("historias").where("orden").belowOrEqual(g).toArray();if(!y.length)return{ok:!0,dueCount:0,nuevasCount:0,nuevasPoolTotal:0,metaNuevasSolicitadas:u,nuevasCupoHoy:0,practicedTodayNew:d.practicedTodayNew||0,practicedTodayTotal:d.practicedTodayTotal||0,lastPracticeDate:d.lastPracticeDate,targetTotalHoy:0,remainingHoy:0,items:[],itemsLimited:[],seleccionadas:[]};let f=new Set(y.map(e=>e.id)),h=await n.idb.table("frases").filter(e=>f.has(e.historiaId)).toArray(),p=h.filter(e=>!m.has(String(e._id||e.id))).filter(e=>{var t;return(null!=(t=e.nivelActual)?t:0)>0||!!e.fechaUltimoEstudio}).filter(e=>{var t;return t=e.revisarEnFecha,!!function(e){if(!e)return!1;let t=new Date(e);return!Number.isNaN(t.getTime())&&t.getFullYear()>2e3}(t)&&o(new Date(t),"America/Bogota")<=c}),b=h.filter(e=>!m.has(String(e._id||e.id))).filter(e=>{var t;return(null!=(t=e.nivelActual)?t:0)===0&&!e.fechaUltimoEstudio}),x=Math.max(0,u-Number(d.practicedTodayNew||0)),w=s(b).slice(0,x),N=(function(e,t){let a=[],r=[...e],l=[...t];for(;r.length||l.length;)r.length&&l.length?a.push(.5>Math.random()?r.shift():l.shift()):r.length?a.push(r.shift()):a.push(l.shift());return a})(s(p),s(w)).map(e=>{var t,a,r;return{...e,_id:String(null!=(t=e._id)?t:e.id),textoIngles:null!=(r=null!=(a=e.textoIngles)?a:e.texto)?r:""}}),v=Number(p.length)+Number(u),S=Math.max(0,v-Number(d.practicedTodayTotal||0)),j=S>0?N.slice(0,S):[];return{ok:!0,dueCount:p.length,nuevasCount:w.length,nuevasPoolTotal:b.length,metaNuevasSolicitadas:u,nuevasCupoHoy:x,practicedTodayNew:d.practicedTodayNew||0,practicedTodayTotal:d.practicedTodayTotal||0,lastPracticeDate:d.lastPracticeDate,targetTotalHoy:v,remainingHoy:S,items:N,itemsLimited:j,seleccionadas:j.length?j:N}}async function d(e){let t=String(e),a=n.idb.table("frases"),r=await a.get(t);if(r)return r;let l=Number(t);return!Number.isNaN(l)&&(r=await a.get(l))?r:await a.filter(e=>String(e.id)===t||String(e._id)===t).first()}async function u(e){var t;let{id:a,respuesta:r}=e,l=await d(a);if(!l)throw Error("Frase no encontrada: "+a);let i=null!=(t=l.nivelActual)?t:0,o="correcta"===r?Math.min(4,(i||0)+1):Math.max(0,(i||0)-1),s=function(e,t){let a=new Date,r=0;if("correcta"===t)switch(e){case 0:r=1;break;case 1:r=3;break;case 2:r=7;break;default:r=30}else r=+(0!==e);let l=new Date(a);return l.setDate(a.getDate()+r),l.toISOString()}(i,r),c=new Date().toISOString(),u={...l,nivelActual:o,ultimaRespuesta:r,fechaUltimoEstudio:c,revisarEnFecha:s};return await n.idb.table("frases").put({...u,id:l.id}),{ok:!0,frase:u}}let g="progressByDay",m="sessionPhrasesByDay";async function y(){let[e,t,a]=await Promise.all([n.idb.historias.toArray(),n.idb.frases.toArray(),n.idb.config.toArray()]),r={},l={};try{r=JSON.parse(localStorage.getItem(g)||"{}")}catch(e){}try{l=JSON.parse(localStorage.getItem(m)||"{}")}catch(e){}let i=new Blob([JSON.stringify({__type:"ingles_tarjetas_backup",version:1,createdAt:new Date().toISOString(),data:{historias:e,frases:t,config:a,progressByDay:r,sessionPhrasesByDay:l}})],{type:"application/json"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download="avance-ingles-".concat(function(){let e=new Date,t=e=>String(e).padStart(2,"0");return"".concat(e.getFullYear()).concat(t(e.getMonth()+1)).concat(t(e.getDate()),"-").concat(t(e.getHours())).concat(t(e.getMinutes())).concat(t(e.getSeconds()))}(),".json"),document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(o)}async function f(e){let t;if(!e)throw Error("No seleccionaste un archivo");let a=await e.text();try{t=JSON.parse(a)}catch(e){throw Error("Archivo inv\xe1lido (no es JSON)")}if(!t||"ingles_tarjetas_backup"!==t.__type||!t.data)throw Error("Backup inv\xe1lido: formato no reconocido");let{historias:r,frases:l,config:i,progressByDay:o,sessionPhrasesByDay:s}=t.data;return await n.idb.transaction("rw",n.idb.historias,n.idb.frases,n.idb.config,async()=>{await n.idb.historias.clear(),await n.idb.frases.clear(),await n.idb.config.clear(),Array.isArray(r)&&r.length&&await n.idb.historias.bulkAdd(r),Array.isArray(l)&&l.length&&await n.idb.frases.bulkAdd(l),Array.isArray(i)&&i.length&&await n.idb.config.bulkAdd(i)}),localStorage.setItem(g,JSON.stringify(o||{})),localStorage.setItem(m,JSON.stringify(s||{})),{ok:!0}}async function h(){await n.idb.delete(),localStorage.removeItem(g),localStorage.removeItem(m),location.reload()}let p="progressByDay",b="sessionPhrasesByDay",x="studySessionSnapshot";function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:"America/Bogota",year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}function N(){let e=w();return JSON.parse(localStorage.getItem(p)||"{}")[e]||0}function v(){let e=w();return JSON.parse(localStorage.getItem(b)||"{}")[e]||[]}function S(){try{return JSON.parse(localStorage.getItem(x)||"null")}catch(e){return null}}let j=async()=>await (0,n.getConfig)()||{id:"appConfig",maxOrden:1,metaDefault:20,lastPracticeDate:null,practicedTodayNew:0,practicedTodayTotal:0},T=async e=>{let t={...await (0,n.getConfig)()||{id:"appConfig",maxOrden:1,metaDefault:20,lastPracticeDate:null,practicedTodayNew:0,practicedTodayTotal:0},...e,id:"appConfig"};return await (0,n.setConfig)(t),{ok:!0,config:await (0,n.getConfig)()||t}};function D(){var e,t,n,o,s;(0,l.useEffect)(()=>{i()},[]);let[d,g]=(0,l.useState)(null),[m,D]=(0,l.useState)(!0),[C,I]=(0,l.useState)(!1),[O,A]=(0,l.useState)(null),[k,E]=(0,l.useState)(null),[P,_]=(0,l.useState)(0),[J,M]=(0,l.useState)(null),[H,F]=(0,l.useState)(null),[U,B]=(0,l.useState)([]),[R,q]=(0,l.useState)(0),[L,z]=(0,l.useState)(!1),[V,W]=(0,l.useState)(!1),[Y,G]=(0,l.useState)(!1),Z=U[R],K=(0,l.useRef)(!1),[Q,X]=(0,l.useState)(!1),$=(0,l.useRef)(null),ee=(0,l.useRef)(null),[et,ea]=(0,l.useState)(28),[er,el]=(0,l.useState)(!1),en=(0,l.useRef)(null),ei=async e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){if(!confirm("Esto reemplazar\xe1 tus datos locales con los del archivo seleccionado. \xbfContinuar?")){e.target.value="";return}try{el(!0),await f(a),alert("Importaci\xf3n completada. Se actualizaron tus datos."),location.reload()}catch(e){alert("Error importando: "+e.message),console.error(e)}finally{el(!1),e.target.value=""}}};(0,l.useEffect)(()=>{(async()=>{try{let e=await j();g(e),function(e){try{var t;let a=w();if(!e||e.lastPracticeDate!==a)return;let r=Number(null!=(t=e.practicedTodayTotal)?t:0),l=JSON.parse(localStorage.getItem(p)||"{}"),n=Number(l[a]||0);r>n&&(l[a]=r,localStorage.setItem(p,JSON.stringify(l)))}catch(e){}}(e)}finally{D(!1),_(N());let e=w(),t=JSON.parse(localStorage.getItem(b)||"{}");t[e]||(t[e]=[],localStorage.setItem(b,JSON.stringify(t)))}})()},[]),(0,l.useEffect)(()=>{try{if(null==Z?void 0:Z.textoIngles){"undefined"!=typeof speechSynthesis&&speechSynthesis.cancel();let e=new SpeechSynthesisUtterance(Z.textoIngles);e.lang="en-US",G(!0),e.onend=()=>G(!1),e.onerror=()=>G(!1),speechSynthesis.speak(e)}else G(!1)}catch(e){G(!1)}},[null==Z?void 0:Z.textoIngles]),(0,l.useEffect)(()=>{let e=requestAnimationFrame(()=>{let e=$.current,t=ee.current;if(!e||!t)return;let a=32;for(t.style.whiteSpace="normal",t.style.wordBreak="break-word",t.style.hyphens="auto",t.style.lineHeight="1.15";a>=14;){t.style.fontSize=a+"px";let r=t.scrollHeight>e.clientHeight,l=t.scrollWidth>e.clientWidth;if(!r&&!l)break;a-=1}ea(a)});return()=>cancelAnimationFrame(e)},[null==Z?void 0:Z.textoIngles,L]);let eo=e=>{let t=w(),a=S(),r=a&&a.dayId===t?a:{dayId:t,baseDueCount:0,meta:0,targetTotalHoy:0,plan:[],idx:0};var l="function"==typeof e?e(r):e;try{localStorage.setItem(x,JSON.stringify(l))}catch(e){}},es=async(e,t)=>{W(!0);try{let r=w(),l=(()=>{let e=w(),t=S();return t&&t.dayId===e?(B(t.plan||[]),q(Math.max(0,Number.isFinite(null==t?void 0:t.idx)?t.idx:0)),M(t.targetTotalHoy||0),F(t.meta||0),t):null})();if(l&&e&&e>(l.meta||0)){let r=await j(),n=Number((null==r?void 0:r.practicedTodayNew)||0),i=Math.max(0,e-n);if(i>0){let r=new Set([...v(),...(l.plan||[]).map(e=>String(e._id))]),o=await Promise.resolve().then(a.bind(a,5357)),s=o.idb||o.default&&o.default.idb;if(!s)throw Error("IDB no disponible");let c=await s.table("historias").where("orden").belowOrEqual(t).toArray(),d=new Set(c.map(e=>e.id)),u=[...(await s.table("frases").filter(e=>d.has(e.historiaId)).toArray()).filter(e=>{var t;return(null!=(t=e.nivelActual)?t:0)===0&&!e.fechaUltimoEstudio}).filter(e=>!r.has(String(e._id||e.id)))];for(let e=u.length-1;e>0;e--){let t=Math.random()*(e+1)|0;[u[e],u[t]]=[u[t],u[e]]}let g=Math.min(i,u.length),m=u.slice(0,g),y=[...l.plan||[],...m],f=Number(l.baseDueCount||0)+n+g;B(y),q(Math.max(0,Number.isFinite(null==l?void 0:l.idx)?l.idx:0)),M(f),F(e),eo({...l,meta:e,targetTotalHoy:f,plan:y,idx:Math.min(l.idx||0,y.length-1)}),_(N());return}{let t=Number(l.baseDueCount||0)+Number(e);B(l.plan||[]),q(Math.max(0,Number.isFinite(null==l?void 0:l.idx)?l.idx:0)),M(t),F(e),eo({...l,meta:e,targetTotalHoy:t}),_(N());return}}if(l)return void _(N());let n=v(),i=await c({limit:e,maxOrden:t,excludeIds:n}),o=(null==i?void 0:i.itemsLimited)&&i.itemsLimited.length?i.itemsLimited:(null==i?void 0:i.seleccionadas)||[],s=Number((null==i?void 0:i.dueCount)||0),d=s+Number(e||(null==i?void 0:i.metaNuevasSolicitadas)||0);B(o),q(0),z(!1),M(d),F(Number(e||(null==i?void 0:i.metaNuevasSolicitadas)||0)),g(e=>{var t,a,r,l;return{...e||{},lastPracticeDate:(null==i?void 0:i.lastPracticeDate)||(null==e?void 0:e.lastPracticeDate),practicedTodayNew:Number(null!=(a=null!=(t=null==i?void 0:i.practicedTodayNew)?t:null==e?void 0:e.practicedTodayNew)?a:0),practicedTodayTotal:Number(null!=(l=null!=(r=null==i?void 0:i.practicedTodayTotal)?r:null==e?void 0:e.practicedTodayTotal)?l:0)}}),_(Number((null==i?void 0:i.practicedTodayTotal)||0)),eo({dayId:r,baseDueCount:s,meta:Number(e||(null==i?void 0:i.metaNuevasSolicitadas)||0),targetTotalHoy:d,plan:o,idx:0})}finally{W(!1)}},ec=async e=>{if(Z&&!Y&&!K.current){K.current=!0,X(!0);try{var t,a;let r=(null!=(t=null==Z?void 0:Z.nivelActual)?t:0)===0&&!(null==Z?void 0:Z.fechaUltimoEstudio),l=await j(),n=Number((null==l?void 0:l.practicedTodayNew)||0),i=Number((null==l?void 0:l.practicedTodayTotal)||0);await u({id:null!=(a=Z.id)?a:Z._id,respuesta:e});let o=await j(),s=Number((null==o?void 0:o.practicedTodayNew)||0),c=Number((null==o?void 0:o.practicedTodayTotal)||0),d=s>n,m=c>i;if(g(o),"correcta"===e){let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=w(),a=JSON.parse(localStorage.getItem(p)||"{}");return a[t]=(a[t]||0)+e,localStorage.setItem(p,JSON.stringify(a)),a[t]}(1);_(e)}if(Z._id&&function(e){let t=w(),a=JSON.parse(localStorage.getItem(b)||"{}"),r=new Set(a[t]||[]);r.add(String(e)),a[t]=Array.from(r),localStorage.setItem(b,JSON.stringify(a))}(Z._id),!m||r&&!d){let e=w(),t=await j();t.lastPracticeDate!==e&&(t.lastPracticeDate=e,t.practicedTodayNew=0,t.practicedTodayTotal=0),m||(t.practicedTodayTotal=Number(t.practicedTodayTotal||0)+1),r&&!d&&(t.practicedTodayNew=Number(t.practicedTodayNew||0)+1);let a=await T(t);(null==a?void 0:a.config)&&g(a.config)}B(t=>{let a=[...t];if("incorrecta"===e){let e=a[R];a.splice(R,1),a.push(e)}else a.splice(R,1);return a.length,eo(e=>{let t=a.length,r=Number.isFinite(R)?R:0,l=Math.max(0,Math.min(r,t-1));return{...e,plan:a,idx:l}}),R+1>=t.length?q(t.length):q(e=>e),a}),setTimeout(()=>{var e;let t=Number((null==(e=S())?void 0:e.targetTotalHoy)||J||0),a=N();t&&a>=t&&(B([]),q(0),eo(e=>({...e,plan:[],idx:0})))},0)}finally{K.current=!1,X(!1)}}};if(m)return(0,r.jsx)("main",{className:"flex items-center justify-center min-h-screen bg-gradient-to-b from-gray-900 to-gray-800 p-4 text-gray-100",children:(0,r.jsx)("div",{className:"bg-gray-800 shadow-xl rounded-2xl p-8 max-w-md w-full text-center border border-gray-700",children:(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"Cargando configuraci\xf3n…"})})});if(V)return(0,r.jsx)("main",{className:"flex items-center justify-center min-h-screen bg-gradient-to-b from-gray-900 to-gray-800 p-4 text-gray-100",children:(0,r.jsx)("div",{className:"bg-gray-800 shadow-xl rounded-2xl p-8 max-w-md w-full text-center border border-gray-700",children:(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"Preparando tu plan de hoy…"})})});if(null===O||null===k)return(0,r.jsx)("main",{className:"flex items-center justify-center min-h-screen bg-gradient-to-b from-gray-900 to-gray-800 p-4 text-gray-100",children:(0,r.jsxs)("div",{className:"bg-gray-800 shadow-xl rounded-2xl p-8 max-w-md w-full space-y-4 border border-gray-700",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-center",children:"Configura tu sesi\xf3n de hoy"}),(0,r.jsxs)("form",{onSubmit:async e=>{e.preventDefault();let t=parseInt(e.target.meta.value,10),a=parseInt(e.target.orden.value,10);if(!isNaN(t)&&t>0&&!isNaN(a)&&a>0){A(t),E(a);try{let e=await T({maxOrden:a,metaDefault:t});(null==e?void 0:e.ok)&&g(e.config)}catch(e){console.warn("No se pudo guardar config por defecto (local):",e)}await es(t,a)}},className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-300",children:"\xbfCu\xe1ntas frases hoy? (meta nuevas)"}),(0,r.jsx)("input",{name:"meta",type:"number",min:"1",defaultValue:null!=(e=null==d?void 0:d.metaDefault)?e:20,className:"w-full border border-gray-600 rounded-lg p-2 bg-gray-700 text-gray-100"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-300",children:"\xbfHasta qu\xe9 historia vas? (maxOrden)"}),(0,r.jsx)("input",{name:"orden",type:"number",min:"1",defaultValue:null!=(t=null==d?void 0:d.maxOrden)?t:1,className:"w-full border border-gray-600 rounded-lg p-2 bg-gray-700 text-gray-100"})]}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Empezar"})]}),(0,r.jsx)("button",{type:"button",onClick:()=>I(e=>!e),className:"w-full bg-gray-700 text-gray-100 px-4 py-2 rounded-lg hover:bg-gray-600",children:"⚙️ Configurar"}),C&&d&&(0,r.jsxs)("div",{className:"mt-4 border border-gray-700 rounded-lg p-4 bg-gray-800",children:[(0,r.jsx)("h2",{className:"font-semibold mb-2 text-gray-100",children:"Configuraci\xf3n"}),(0,r.jsxs)("form",{onSubmit:async e=>{e.preventDefault();let t=parseInt(e.target.maxOrden.value,10);g((await T({maxOrden:t})).config),I(!1)},className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-300",children:"Por cual Historia vas:"}),(0,r.jsx)("input",{name:"maxOrden",type:"number",min:"1",defaultValue:d.maxOrden,className:"w-full border border-gray-600 rounded-lg p-2 bg-gray-700 text-gray-100"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Guardar"}),(0,r.jsx)("button",{type:"button",onClick:()=>I(!1),className:"px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-100",children:"Cancelar"})]})]}),(0,r.jsxs)("div",{className:"mt-4 p-3 rounded-lg border border-gray-700 bg-gray-900/60",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2 text-gray-100",children:"Respaldo y traslado de avance"}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>y(),className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg",children:"⬇️ Exportar avance (JSON)"}),(0,r.jsx)("button",{type:"button",disabled:er,onClick:()=>{var e;return null==(e=en.current)?void 0:e.click()},className:"w-full bg-cyan-600 hover:bg-cyan-700 disabled:opacity-60 text-white px-4 py-2 rounded-lg",children:"⬆️ Importar avance (JSON)"}),(0,r.jsx)("button",{type:"button",onClick:async()=>{if(confirm("Esto borrar\xe1 todo tu avance local y reiniciar\xe1 la app. \xbfSeguro?")){await h();try{localStorage.removeItem(p),localStorage.removeItem(b);try{localStorage.removeItem(x)}catch(e){}}catch(e){}location.reload()}},className:"w-full bg-gray-700 hover:bg-gray-600 text-gray-100 px-4 py-2 rounded-lg",children:"\uD83D\uDDD1️ Reset de f\xe1brica"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:"Exporta tu avance para llevarlo a otra m\xe1quina. En la otra m\xe1quina, abre la app, ve a “Configurar” y usa “Importar avance (JSON)”."})]}),(0,r.jsx)("input",{ref:en,type:"file",accept:"application/json",onChange:ei,style:{display:"none"}})]}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"Solo se tomar\xe1n frases que “toquen hoy” (revisarEnFecha ≤ hoy) y de historias con orden ≤ al que indiques."})]})});if(!Z&&!V)return(0,r.jsx)("main",{className:"flex items-center justify-center min-h-screen bg-gradient-to-b from-gray-900 to-gray-800 p-4 text-gray-100",children:(0,r.jsxs)("div",{className:"bg-gray-800 shadow-xl rounded-2xl p-8 max-w-lg w-full text-center border border-gray-700",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"\xa1Plan del d\xeda completado! \uD83C\uDF89"}),(0,r.jsxs)("p",{className:"text-gray-300 mt-2",children:["Hechas hoy: ",(0,r.jsx)("strong",{children:null!=(n=null==d?void 0:d.practicedTodayNew)?n:0})," / ",null!=H?H:0]}),(0,r.jsx)("div",{className:"mt-6 flex justify-center gap-3",children:(0,r.jsx)("button",{type:"button",onClick:()=>{A(null),E(null),B([]),q(0)},className:"px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-100",children:"Nueva sesi\xf3n"})})]})});let ed="bg-gray-800 shadow-xl rounded-2xl p-4 border border-gray-700 w-[462px]",eu=L?ed+" min-h-[378px]":ed+" h-[378px]";return(0,r.jsx)("main",{className:"flex items-center justify-center min-h-screen bg-gradient-to-b from-gray-900 to-gray-800 p-4 text-gray-100",children:(0,r.jsxs)("div",{className:eu+" flex flex-col",children:[(0,r.jsxs)("div",{className:"w-full flex justify-between text-[11px] text-gray-300 mb-1",children:[(0,r.jsxs)("span",{children:["Trabajar hoy: ",P,"/",null!=J?J:"…"]}),(0,r.jsxs)("span",{children:["Nuevas hoy: ",null!=(o=null==d?void 0:d.practicedTodayNew)?o:0,"/",null!=H?H:0]})]}),(0,r.jsx)("div",{ref:$,className:"flex-1 overflow-hidden flex items-center justify-center text-center px-2",children:(0,r.jsxs)("h2",{ref:ee,style:{fontSize:"".concat(et,"px"),lineHeight:1.15},className:"font-semibold text-blue-400 break-words",children:[null==Z?void 0:Z.textoIngles,Z&&(null!=(s=Z.nivelActual)?s:0)===0&&!Z.fechaUltimoEstudio&&(0,r.jsx)("span",{className:"ml-2 text-[10px] px-2 py-0.5 rounded-full border border-amber-400 text-amber-300",children:"Nueva"})]})}),(0,r.jsxs)("div",{className:"mt-2 flex flex-col gap-2",children:[(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{type:"button",onClick:()=>(null==Z?void 0:Z.textoIngles)&&(e=>{try{if(!e)return;"undefined"!=typeof speechSynthesis&&speechSynthesis.cancel();let t=new SpeechSynthesisUtterance(e);t.lang="en-US",G(!0),t.onend=()=>G(!1),t.onerror=()=>G(!1),speechSynthesis.speak(t)}catch(e){G(!1)}})(Z.textoIngles),disabled:Y||Q,className:"bg-blue-600 text-white px-4 py-1.5 rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:"\uD83D\uDD0A Escuchar"})}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{type:"button",onClick:()=>z(!L),disabled:Q,className:"text-xs text-blue-400 underline disabled:opacity-50 disabled:cursor-not-allowed",children:L?"Ocultar traducci\xf3n":"Mostrar traducci\xf3n"})}),L&&(0,r.jsx)("div",{className:"text-sm text-center text-gray-200 bg-gray-700 p-2 rounded w-full max-h-28 overflow-auto",children:null==Z?void 0:Z.traduccion}),(0,r.jsxs)("div",{className:"flex justify-between w-full mt-1 gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>ec("incorrecta"),disabled:Y||Q,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 w-1/2 disabled:opacity-50 disabled:cursor-not-allowed",children:"❌ No la entend\xed"}),(0,r.jsx)("button",{type:"button",onClick:()=>ec("correcta"),disabled:Y||Q,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 w-1/2 disabled:opacity-50 disabled:cursor-not-allowed",children:"✅ La entend\xed"})]})]})]})})}},5357:(e,t,a)=>{a.r(t),a.d(t,{getConfig:()=>l,idb:()=>r,setConfig:()=>n});let r=new(a(8666)).Ay("ingles_tarjetas");async function l(){return await r.table("config").get("appConfig")||null}async function n(e){let t=await l()||{id:"appConfig"};await r.table("config").put({...t,...e,id:"appConfig"})}r.version(1).stores({historias:"++id, orden",frases:"++id, historiaId, historiaOrden, orden, revisarEnFecha, nivelActual",config:"id"})}}]);